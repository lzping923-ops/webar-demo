<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>OpenWay WebAR Demo</title>

<style>
:root{
  --yellow:#F5C542;
  --green:#34C759;
  --red:#FF3B30;
  --shadow:0 12px 30px rgba(0,0,0,.35);
}
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui;
}
#camera{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}
#ui{
  position:fixed;
  inset:0;
  pointer-events:none;
}

/* STATES */
.state{
  position:absolute;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  text-align:center;
}
.state.active{display:flex;}

#clickLayer{
  position:absolute;
  inset:0;
  pointer-events:auto;
}

/* CARD */
.card{
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.15);
  backdrop-filter:blur(10px);
  border-radius:18px;
  padding:16px;
  max-width:80%;
  color:#fff;
  box-shadow:var(--shadow);
}
.title{font-size:18px;font-weight:700;margin-bottom:6px;}
.sub{font-size:14px;opacity:.85}

/* ARROW + ROUTE */
#arrow{
  position:absolute;
  bottom:48%;
  left:50%;
  transform:translateX(-50%);
  width:70px;
  display:none;
}
#route{
  position:absolute;
  bottom:22%;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  flex-direction:column;
  gap:14px;
}
.dot{
  width:14px;height:14px;border-radius:50%;
  background:var(--yellow);
  opacity:.8;
}

/* ARRIVED CARD */
.arrived{
  position:absolute;
  bottom:18%;
  left:50%;
  transform:translateX(-50%);
  width:85%;
  max-width:520px;
}
.arrived h3{
  margin:0 0 8px 0;
  font-size:18px;
}
.arrived ul{
  margin:0;
  padding-left:18px;
  text-align:left;
  font-size:14px;
}
</style>
</head>

<body>

<video id="camera" autoplay playsinline muted></video>

<div id="ui">
  <div id="clickLayer"></div>

  <!-- START -->
  <div class="state active" id="start">
    <div class="card">
      <div class="title">Start Scan</div>
      <div class="sub">Tap to start AR scanning</div>
    </div>
  </div>

  <!-- SCAN -->
  <div class="state" id="scan">
    <div class="card">
      <div class="title">Scanning</div>
      <div class="sub">Detecting environment…</div>
    </div>
  </div>

  <!-- DETECTED -->
  <div class="state" id="detected">
    <div class="card">
      <div class="title">Accessible Route Detected</div>
      <div class="sub">Tap to start guidance</div>
    </div>
  </div>

  <!-- GUIDANCE -->
  <div class="state" id="guide">
    <img id="arrow" src="arrow.png" />
    <div id="route">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <!-- ARRIVED -->
  <div class="state" id="arrived">
    <div class="card arrived">
      <h3 id="placeName"></h3>
      <ul id="placeBullets"></ul>
    </div>
  </div>
</div>

<script>
/* CAMERA */
async function startCamera(){
  const stream = await navigator.mediaDevices.getUserMedia({
    video:{facingMode:"environment"}
  });
  document.getElementById("camera").srcObject = stream;
}

/* STATES */
const states=["start","scan","detected","guide","arrived"];
let step=0;

function show(id){
  states.forEach(s=>document.getElementById(s).classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("arrow").style.display =
    (id==="guide")?"block":"none";
}

/* ARRIVED DATA */
const locations = {
  library:{
    name:"USM Library – Hamzah Sendut",
    bullets:[
      "Accessible entrance available (ramp / step-free)",
      "Wheelchair-friendly pathways and wide aisles",
      "Nearby accessible restroom and elevator access"
    ]
  },
  dtsp:{
    name:"Lecture Hall – DTSP",
    bullets:[
      "Step-free entrance via ramp",
      "Wide corridor and turning space",
      "Accessible seating area available"
    ]
  },
  cafesiswa:{
    name:"Cafe Siswa",
    bullets:[
      "Step-free entry at main entrance",
      "Wide seating aisles for wheelchair access",
      "Staff assistance available on request"
    ]
  }
};

/* LOCATION SWITCH */
let activeLocationKey="library";
const params=new URLSearchParams(location.search);
const loc=params.get("loc");
if(loc && locations[loc]) activeLocationKey=loc;

function renderArrived(){
  const data=locations[activeLocationKey];
  document.getElementById("placeName").textContent=data.name;
  const ul=document.getElementById("placeBullets");
  ul.innerHTML="";
  data.bullets.forEach(t=>{
    const li=document.createElement("li");
    li.textContent=t;
    ul.appendChild(li);
  });
}

/* FLOW */
document.getElementById("clickLayer").addEventListener("click",async()=>{
  if(step===0){await startCamera();show("scan");}
  if(step===1){show("detected");}
  if(step===2){show("guide");}
  if(step===3){renderArrived();show("arrived");}
  if(step===4){step=-1;show("start");}
  step++;
});
</script>

</body>
</html>
