<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>WebAR Route Prototype</title>

  <style>
    :root{
      /* JS 会写入 --vh 来避免手机地址栏导致的走位 */
      --vh: 1vh;

      --yellow: #F5C542;
      --green: #34C759;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Camera full screen */
    #camera {
      position: fixed;
      inset: 0;
      width: 100%;
      height: calc(var(--vh) * 100);
      object-fit: cover;
      z-index: 0;
      background: #000;
    }

    /* UI overlay */
    #ui {
      position: fixed;
      inset: 0;
      height: calc(var(--vh) * 100);
      z-index: 10;
      pointer-events: none; /* 默认不挡点按 */
    }

    /* Back button (optional) */
    .back {
      position: absolute;
      top: env(safe-area-inset-top, 0);
      left: 12px;
      margin-top: 10px;
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      display: grid;
      place-items: center;
      pointer-events: auto;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,.15);
    }
    .back svg { opacity: .95; }

    /* Intro overlay */
    #intro {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,.08);
      pointer-events: auto; /* 允许点击 */
    }

    .tap {
      position: absolute;
      bottom: calc(env(safe-area-inset-bottom, 0) + 28px);
      width: 100%;
      text-align: center;
      color: rgba(255,255,255,.9);
      font-size: 16px;
      letter-spacing: .2px;
      text-shadow: 0 6px 18px rgba(0,0,0,.45);
    }

    /* Route container - "贴地感" */
    #route {
      position: absolute;
      left: 50%;
      bottom: 22%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.35));
      pointer-events: none;
      opacity: 0;
      transform-origin: center;
      transition: opacity .25s ease;
    }

    /* Dot base */
    .dot {
      width: 16px;
      height: 16px;
      background: var(--yellow);
      border-radius: 50%;
      box-shadow: 0 0 0 2px rgba(255,255,255,.08) inset;
      animation: pulse 1.6s infinite ease-in-out;
      will-change: opacity, transform;
    }

    /* 透视感：越远越小越淡 */
    .dot:nth-child(1) { opacity: 0.35; transform: scale(0.75) scaleY(0.92); animation-delay: 0s; }
    .dot:nth-child(2) { opacity: 0.55; transform: scale(0.85) scaleY(0.92); animation-delay: 0.2s; }
    .dot:nth-child(3) { opacity: 0.80; transform: scale(0.95) scaleY(0.92); animation-delay: 0.4s; }
    .dot:nth-child(4) { opacity: 1.00; transform: scale(1.00) scaleY(0.92); animation-delay: 0.6s; }

    /* 流动感：克制的“呼吸” */
    @keyframes pulse {
      0%   { filter: brightness(0.95); }
      50%  { filter: brightness(1.15); }
      100% { filter: brightness(0.95); }
    }

    /* Optional: subtle ground glow */
    .dot::after{
      content:"";
      display:block;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 22px rgba(245,197,66,.55);
      opacity: .35;
    }

    /* Detected banner */
    #detected {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -54%);
      text-align: center;
      opacity: 0;
      transition: opacity .25s ease, transform .25s ease;
      pointer-events: none;
    }

    .check {
      width: 120px;
      height: 120px;
      border-radius: 28px;
      background: var(--green);
      display: grid;
      place-items: center;
      margin: 0 auto 10px auto;
      box-shadow: var(--shadow);
    }

    .detected-text {
      font-weight: 800;
      font-size: 46px;
      line-height: 1.05;
      color: var(--yellow);
      text-shadow: 0 10px 24px rgba(0,0,0,.45);
      letter-spacing: .4px;
    }

    /* 状态：运行中 */
    body.is-running #route { opacity: 1; }
    /* 状态：检测到 */
    body.is-detected #detected {
      opacity: 1;
      transform: translate(-50%, -58%);
    }

    /* Small hint */
    .hint {
      position: absolute;
      top: calc(env(safe-area-inset-top, 0) + 70px);
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 13px;
      backdrop-filter: blur(10px);
      pointer-events: none;
      opacity: 0;
      transition: opacity .25s ease;
    }
    body.is-running .hint { opacity: 1; }
  </style>
</head>

<body>
  <video id="camera" autoplay playsinline muted></video>

  <div id="ui">
    <!-- Optional back -->
    <div class="back" onclick="location.reload()" aria-label="Back">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
        <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <div class="hint">Tap to toggle “Detected”</div>

    <!-- Route dots -->
    <div id="route" aria-hidden="true">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>

    <!-- Detected UI -->
    <div id="detected" aria-hidden="true">
      <div class="check">
        <svg width="70" height="70" viewBox="0 0 24 24" fill="none">
          <path d="M20 6L9 17l-5-5" stroke="white" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="detected-text">Accessible Route<br/>Detected</div>
    </div>

    <!-- Tap anywhere to continue -->
    <div id="intro">
      <div class="tap">Tap anywhere to continue</div>
    </div>
  </div>

  <script>
    // Fix mobile viewport height drifting (address bar / camera)
    function setVH() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
    setVH();

    const video = document.getElementById('camera');
    const intro = document.getElementById('intro');

    async function startCamera() {
      // Prefer back camera
      const constraints = {
        audio: false,
        video: {
          facingMode: { ideal: 'environment' },
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };

      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        await video.play();
      } catch (err) {
        alert("Camera cannot be started.\n\nTry:\n- HTTPS (GitHub Pages is OK)\n- Allow camera permission\n- Use Chrome\n\nError: " + err.message);
        console.error(err);
      }
    }

    // Tap to continue: start camera + show route
    intro.addEventListener('click', async () => {
      intro.style.display = 'none';
      await startCamera();
      document.body.classList.add('is-running');
    });

    // Tap anywhere to toggle detected UI (demo)
    document.addEventListener('click', (e) => {
      // avoid double triggering on intro
      if (intro.style.display !== 'none') return;
      // toggle detected state
      document.body.classList.toggle('is-detected');
    });

    // Safety: if user already granted permission and browser autoplay works, you can optionally auto-start
    // (but for mobile, tap-first is more reliable).
  </script>
</body>
</html>
