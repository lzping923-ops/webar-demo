<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OpenWay WebAR Prototype</title>

  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }

    /* Camera (always full screen) */
    #cam{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      object-fit:cover;
      background:#000;
      z-index:0;
    }

    /* UI layer */
    #ui{
      position:fixed; inset:0;
      z-index:10;
      pointer-events:none;
    }

    .el{
      position:absolute;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
      transform-origin:center center;
    }

    /* --- Base positions (you can tweak these) --- */

    /* back icon */
    #back{
      left: 16px; top: 16px;
      width: 44px;
      opacity: .95;
    }

    /* scanning text + frame */
    #scanText{
      left:50%; top: 18%;
      transform: translateX(-50%);
      width: min(84vw, 560px);
      opacity: .98;
    }
    #scanFrame{
      left:50%; top: 54%;
      transform: translate(-50%,-50%);
      width: min(78vw, 560px);
      opacity: .98;
    }

    /* detected (CHECK + text)  ← you asked: move check a bit up */
    #check{
      left:50%;
      top: 20%;                /* was lower; move UP by decreasing this */
      transform: translateX(-50%);
      width: min(32vw, 140px);
      opacity: .98;
    }
    #detText{
      left:50%;
      top: 34%;
      transform: translateX(-50%);
      width: min(78vw, 560px);
      opacity: .98;
    }

    /* guide (ARROW + DOTS)  ← you asked: arrow move up */
    #arrow{
      left: 14%;
      top: 36%;                /* move UP by decreasing this */
      width: min(34vw, 180px);
      opacity: .98;
    }
    #dots{
      left:50%;
      top: 62%;
      transform: translateX(-50%);
      width: min(64vw, 460px);
      opacity: .98;
    }

    /* blocked X */
    #xmark{
      left:50%; top: 20%;
      transform: translateX(-50%);
      width: min(36vw, 160px);
      opacity: .98;
    }

    /* Start screen */
    #start{
      position:fixed; inset:0;
      z-index:20;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:12px;
      background: rgba(0,0,0,.55);
    }
    #start button{
      border:0;
      border-radius:14px;
      padding:12px 18px;
      font: 600 14px system-ui;
      cursor:pointer;
    }
    #start p{
      margin:0;
      color:#fff;
      opacity:.9;
      font: 13px system-ui;
      text-align:center;
      padding: 0 18px;
    }

    /* Hint */
    #hint{
      position:fixed; left:0; right:0; bottom:14px;
      z-index:15;
      text-align:center;
      color:#fff;
      font: 13px system-ui;
      opacity:.80;
      pointer-events:none;
      padding:0 14px;
    }

    /* Optional: hide hint on desktop wide screens */
    @media (min-width: 900px){
      #hint{ opacity:.65; }
    }
  </style>
</head>

<body>
  <video id="cam" autoplay playsinline muted></video>

  <div id="ui">
    <!-- Always visible back icon (visual only) -->
    <img id="back" class="el" src="back.png" alt="Back" />

    <!-- SCANNING -->
    <img id="scanText"  class="el" src="scan_text.png" alt="Scan around to find Accessible Entrance" />
    <img id="scanFrame" class="el" src="scan_frame.png" alt="Scan frame" />

    <!-- DETECTED -->
    <img id="check"  class="el" src="check.png" alt="Check" />
    <img id="detText" class="el" src="detected_text.png" alt="Accessible Route Detected" />

    <!-- GUIDE -->
    <img id="arrow" class="el" src="arrow.png" alt="Arrow" />
    <img id="dots"  class="el" src="dots.png" alt="Dots" />

    <!-- BLOCKED -->
    <img id="xmark" class="el" src="x.png" alt="Not accessible" />
  </div>

  <div id="hint">Tap anywhere to continue</div>

  <div id="start">
    <button id="startBtn">Start Camera</button>
    <p>If you don’t see the camera, please allow camera permission in Chrome.</p>
  </div>

  <script>
    // ---- 1) Camera ----
    const cam = document.getElementById("cam");
    const startLayer = document.getElementById("start");
    const startBtn = document.getElementById("startBtn");

    async function startCamera(){
      try{
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { ideal: "environment" } },
          audio: false
        });
        cam.srcObject = stream;
        startLayer.style.display = "none";
      }catch(e){
        alert("Camera permission is required. Please open in Chrome and allow camera.");
        console.error(e);
      }
    }
    startBtn.addEventListener("click", startCamera);

    // ---- 2) UI state machine ----
    // States: scanning -> detected -> guide -> blocked -> back to scanning (loop)
    const states = ["scanning","detected","guide","blocked"];
    let idx = 0;

    const setVisible = (id, on) => {
      const el = document.getElementById(id);
      if (!el) return;
      el.style.display = on ? "" : "none";
    };

    function showState(s){
      // Always show back (visual only)
      setVisible("back", true);

      // scanning
      setVisible("scanText",  s === "scanning");
      setVisible("scanFrame", s === "scanning");

      // detected
      setVisible("check",   s === "detected");
      setVisible("detText", s === "detected");

      // guide
      setVisible("arrow", s === "guide");
      setVisible("dots",  s === "guide");

      // blocked
      setVisible("xmark", s === "blocked");
    }

    // Initial UI
    showState(states[idx]);

    // Tap anywhere (except the Start overlay) to advance
    document.addEventListener("click", (e) => {
      // If start layer is visible, ignore taps behind it
      if (startLayer.style.display !== "none") return;

      idx = (idx + 1) % states.length;
      showState(states[idx]);
    });

    // ---- 3) Optional: keyboard control (desktop demo) ----
    // 1/2/3/4 to jump to a state
    document.addEventListener("keydown", (e) => {
      const map = { "1":0, "2":1, "3":2, "4":3 };
      if (map[e.key] !== undefined){
        idx = map[e.key];
        showState(states[idx]);
      }
    });
  </script>
</body>
</html>
